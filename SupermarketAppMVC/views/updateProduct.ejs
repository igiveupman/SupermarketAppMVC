<%- include('partials/header', { user, pageTitle: 'Update Product' }) %>
  <div class="container-narrow">
    <h2 class="text-center mb-4">Update Product</h2>
    
    <% if (product) { %>
      <% if (errors && errors.length) { %>
        <div class="alert alert-danger"><%= errors.join(', ') %></div>
      <% } %>
      <% if (messages && messages.length) { %>
        <div class="alert alert-success"><%= messages.join(', ') %></div>
      <% } %>
      <form action="/updateProduct/<%= product.id %>" method="POST" enctype="multipart/form-data" class="mx-auto" style="max-width: 500px;">
        
        <div class="mb-3">
          <label for="name" class="form-label">Product Name</label>
          <input type="text" class="form-control" id="name" name="name" value="<%= product.productName %>" required>
        </div>

        <div class="mb-3">
          <label for="quantity" class="form-label">Quantity</label>
          <input type="number" class="form-control" id="quantity" name="quantity" min="0" step="1" value="<%= product.quantity %>" required>
        </div>

        <div class="mb-3">
          <label for="price" class="form-label">Price</label>
          <input type="number" class="form-control" id="price" name="price" min="0" step="0.01" value="<%= Number(product.price).toFixed(2) %>" required>
        </div>

        <div class="mb-3">
          <label for="discount_price" class="form-label">Discount Price (optional)</label>
          <input type="number" class="form-control" id="discount_price" name="discount_price" min="0" step="0.01" value="<%= product.discount_price ? Number(product.discount_price).toFixed(2) : '' %>" placeholder="e.g. 39.90">
          <small class="text-muted">Blank = no discount.</small>
        </div>

        <div class="mb-3">
          <label for="category" class="form-label">Category</label>
          <select id="category" name="category" class="form-control" required>
            <option value="Bakery" <%= product.category === 'Bakery' ? 'selected' : '' %>>Bakery</option>
            <option value="Dairy" <%= product.category === 'Dairy' ? 'selected' : '' %>>Dairy</option>
            <option value="Produce" <%= product.category === 'Produce' ? 'selected' : '' %>>Fruits and Vegetables</option>
            <option value="Meats" <%= product.category === 'Meats' ? 'selected' : '' %>>Meats</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Current Image</label>
          <input type="text" class="form-control" name="currentImage" value="<%= product.image %>" readonly>
          <img src="/images/<%= product.image %>" class="img-thumbnail mt-2" style="width: 150px;">
        </div>

        <div class="mb-4">
          <label for="image" class="form-label">Upload New Image</label>
          <input class="form-control" type="file" id="image" name="image" accept="image/*">
        </div>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary">Update Product</button>
          <a href="/inventory" class="btn btn-secondary">Back to Inventory</a>
        </div>
      </form>
    <% } else { %>
      <p class="text-center">No product found.</p>
    <% } %>
  </div>
<%- include('partials/footer') %>
