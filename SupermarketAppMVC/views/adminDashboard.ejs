<%- include('partials/header', { user, pageTitle: 'Admin Dashboard' }) %>
<h1 class="mb-3 hero-title">Admin Dashboard</h1>
<p class="muted mb-4">Welcome, <strong><%= user.username %></strong> <small>(<%= user.role %>)</small></p>
<div class="action-widgets mb-4">
  <a class="widget" href="/inventory" aria-label="Manage inventory">
    <div class="widget-icon">ðŸ“¦</div>
    <div class="widget-body">
      <h4>Inventory</h4>
      <p class="muted">View & edit stock.</p>
    </div>
    <div class="widget-action">â†’</div>
  </a>
  <a class="widget" href="/addProduct" aria-label="Add product">
    <div class="widget-icon">âž•</div>
    <div class="widget-body">
      <h4>Add Product</h4>
      <p class="muted">Create new item.</p>
    </div>
    <div class="widget-action">â†’</div>
  </a>
  <a class="widget" href="/admin/users" aria-label="Manage users">
    <div class="widget-icon">ðŸ‘¥</div>
    <div class="widget-body">
      <h4>Users</h4>
      <p class="muted">Roles & accounts.</p>
    </div>
    <div class="widget-action">â†’</div>
  </a>
  <a class="widget" href="/admin/users" aria-label="Manage orders">
    <div class="widget-icon">ðŸ§¾</div>
    <div class="widget-body">
      <h4>Manage Orders</h4>
      <p class="muted">View & clear user history.</p>
    </div>
    <div class="widget-action">â†’</div>
  </a>
  <a class="widget" href="/logout" aria-label="Logout">
    <div class="widget-icon">ðŸšª</div>
    <div class="widget-body">
      <h4>Logout</h4>
      <p class="muted">Sign out.</p>
    </div>
    <div class="widget-action">â†’</div>
  </a>
</div>
<% if (errors && errors.length) { %>
  <div class="alert alert-danger"><%= errors.join(', ') %></div>
<% } %>
<% if (messages && messages.length) { %>
  <div class="alert alert-success"><%= messages.join(', ') %></div>
<% } %>
<div class="row g-4">
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-header fw-semibold">Products (<%= products.length %>)</div>
      <ul class="list-group list-group-flush">
        <% products.forEach(p => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <a href="/admin/products/<%= p.id %>" class="text-decoration-none"><%= p.productName %></a>
            <span class="badge bg-secondary"><%= p.category || 'Uncategorized' %></span>
          </li>
        <% }) %>
        <% if (products.length === 0) { %>
          <li class="list-group-item">No products found.</li>
        <% } %>
      </ul>
      <div class="card-footer text-end">
        <a href="/addProduct" class="btn btn-primary btn-sm" aria-label="Add new product">Add Product</a>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-header fw-semibold">Users (<%= users.length %>)</div>
      <ul class="list-group list-group-flush">
        <% users.forEach(u => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
            <div class="d-flex align-items-center gap-2">
              <span class="fw-semibold"><%= u.username %></span>
              <span class="badge bg-dark"><%= u.role %></span>
            </div>
            <div class="d-flex align-items-center gap-2 mt-2 mt-md-0">
              <a href="/admin/users/<%= u.id %>/edit" class="btn btn-sm btn-outline-primary" aria-label="Edit <%= u.username %>">Edit</a>
              <a href="/admin/users/<%= u.id %>/orders" class="btn btn-sm btn-outline-secondary" aria-label="View orders for <%= u.username %>">Orders</a>
              <form action="/admin/users/<%= u.id %>/delete" method="POST" style="display:inline" onsubmit="return confirm('Delete user <%= u.username %>? This action cannot be undone.');">
                <button type="submit" class="btn btn-sm btn-outline-danger" aria-label="Delete <%= u.username %>">Delete</button>
              </form>
            </div>
          </li>
        <% }) %>
        <% if (users.length === 0) { %>
          <li class="list-group-item">No users found.</li>
        <% } %>
      </ul>
      <div class="card-footer text-end">
        <a href="/admin/users" class="btn btn-sm btn-secondary" aria-label="Go to full user management page">Manage Users</a>
      </div>
    </div>
  </div>
</div>
<%- include('partials/footer') %>
