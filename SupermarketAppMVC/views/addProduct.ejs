<%- include('partials/header', { user, pageTitle: 'Add Product' }) %>
<section class="admin-form-wrapper">
  <div class="admin-panel shadow-sm">
    <div class="auth-header">
      <h1 class="auth-title">Add Product</h1>
      <p class="auth-sub">Create a new inventory item</p>
    </div>
    <% if (messages && messages.length) { %>
      <div class="alert alert-success mb-3"><%= messages.join(', ') %></div>
    <% } %>
    <% if (errors && errors.length) { %>
      <div class="alert alert-danger mb-3"><%= errors.join(', ') %></div>
    <% } %>
    <form action="/addProduct" method="POST" enctype="multipart/form-data" class="admin-form" novalidate>
      <div class="form-floating mb-3">
        <input type="text" class="form-control" id="name" name="name" placeholder="Product Name" required>
        <label for="name">Product Name</label>
      </div>
      <div class="form-floating mb-3">
        <input type="number" class="form-control" id="quantity" name="quantity" placeholder="Quantity" min="0" step="1" required>
        <label for="quantity">Quantity</label>
      </div>
      <div class="form-floating mb-3">
        <input type="number" class="form-control" id="price" name="price" placeholder="Price" min="0" step="0.01" required>
        <label for="price">Price ($)</label>
      </div>
      <div class="form-floating mb-3">
        <input type="number" class="form-control" id="discount_percent" name="discount_percent" placeholder="Discount (%)" min="0" max="100" step="0.01">
        <label for="discount_percent">Discount (%) (optional)</label>
      </div>
  <div class="mb-3 small text-muted" id="discountPreviewAdd" style="display:none;"></div>
      <div class="mb-3">
        <label for="category" class="form-label">Category</label>
        <select id="category" name="category" class="form-select admin-select" required>
          <option value="" selected>Select category</option>
          <option value="Bakery">Bakery</option>
          <option value="Dairy">Dairy</option>
          <option value="Produce">Fruits & Vegetables</option>
          <option value="Meats">Meats</option>
        </select>
      </div>
      <div class="mb-4">
        <label for="image" class="form-label">Product Image (optional)</label>
        <input class="form-control" type="file" id="image" name="image" accept="image/*">
      </div>
      <button type="submit" class="btn btn-primary w-100">Add Product</button>
    </form>
  </div>
</section>
<script>
  (function(){
    const price = document.getElementById('price');
    const pct = document.getElementById('discount_percent');
    const out = document.getElementById('discountPreviewAdd');
    if(!price || !pct || !out) return;
    function render(){
      const p = parseFloat(price.value);
      const d = parseFloat(pct.value);
      if(isFinite(p) && isFinite(d)){
        const final = Math.max(0, p * (1 - Math.min(100, Math.max(0,d))/100));
        out.style.display = '';
        out.innerText = `Final price after ${d.toFixed(2)}%: $${final.toFixed(2)} (was $${p.toFixed(2)})`;
      } else {
        out.style.display = 'none';
        out.innerText = '';
      }
    }
    price.addEventListener('input', render);
    pct.addEventListener('input', render);
    render();
  })();
</script>
<%- include('partials/footer') %>
