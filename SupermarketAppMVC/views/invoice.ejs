<%- include('partials/header', { user, pageTitle: 'Invoice #' + order.id, currentPage: 'orders', messages: (typeof messages !== 'undefined' ? messages : []), errors: (typeof errors !== 'undefined' ? errors : []) }) %>

<style>
  .invoice { max-width: 980px; margin: 0 auto; padding: 24px 16px; }
  .invoice-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
  .brand { display:flex; align-items:center; gap:12px; }
  .brand-logo { width:40px; height:40px; }
  .brand-text h1 { margin:0; font-size:22px; }
  .muted { color:#64748b; font-size:14px; }
  .btn-print { background:#e2e8f0; border:1px solid #cbd5e1; padding:8px 12px; border-radius:8px; }
  .invoice-meta .title { font-size:28px; font-weight:700; margin-bottom:8px; }
  .invoice-meta .muted { font-weight:400; }
  .invoice-meta .meta-grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; align-items:start; }
  .invoice-meta .label { font-size:13px; color:#64748b; }
  .invoice-meta .value { font-size:15px; }
  .table-clean { width:100%; border-collapse:collapse; margin-top:12px; background:#fff; border:1px solid #e2e8f0; }
  .table-clean thead th { background:#f8fafc; border-bottom:1px solid #e2e8f0; padding:10px; font-weight:600; }
  .table-clean td { padding:10px; border-bottom:1px solid #f1f5f9; }
  .text-start { text-align:left; }
  .text-end { text-align:right; }
  .totals-box { margin-top:16px; border:1px solid #e2e8f0; border-radius:8px; padding:12px 16px; background:#fff; max-width:420px; margin-left:auto; }
  .totals-box .row-line { display:flex; justify-content:space-between; padding:6px 0; }
  .totals-box .total { font-weight:700; font-size:18px; }
  .invoice-footer { display:flex; justify-content:space-between; align-items:center; margin-top:16px; }
  .back-link { text-decoration:none; color:#2563eb; }

  @media print {
    .main-nav, .nav-actions, .btn, .btn-print, .back-link { display: none !important; }
    .invoice { max-width: 900px; }
    .table-clean thead th, .table-clean td { padding: 8px 10px; }
  }
</style>

<div class="invoice">
  <header class="invoice-header">
    <div class="brand">
      <img class="brand-logo" src="/images/logo.png" alt="UnFairPrice">
      <div class="brand-text">
        <h1>UnFairPrice</h1>
        <div class="muted">Prices are fair and cheap</div>
      </div>
    </div>
    <div class="actions">
      <button class="btn btn-print" onclick="window.print()">&#128424; Print</button>
    </div>
  </header>

  <section class="invoice-meta">
    <div class="title">Invoice <span class="muted">#<%= order.id %></span></div>
    <div class="meta-grid">
      <div>
        <div class="label">Billed To</div>
        <div class="value"><strong><%= user.username %></strong></div>
        <div class="value"><%= user.email %></div>
        <% if (user.address) { %><div class="value"><%= user.address %></div><% } %>
      </div>
      <div class="text-end">
        <div class="label">Date</div>
        <div class="value"><%= new Date(order.created_at || order.createdAt).toLocaleString() %></div>
        <div class="label mt-2">Order ID</div>
        <div class="value"><%= order.id %></div>
      </div>
    </div>
  </section>

  <div class="table-responsive">
    <table class="table table-clean">
      <thead>
        <tr>
          <th class="text-start">Item</th>
          <th class="text-end">Qty</th>
          <th class="text-end">Price</th>
          <th class="text-end">Total</th>
        </tr>
      </thead>
      <tbody>
        <% items.forEach(it => { %>
          <tr>
            <td class="text-start"><%= it.productName %></td>
            <td class="text-end"><%= it.quantity %></td>
            <td class="text-end">$<%= Number(it.price).toFixed(2) %></td>
            <td class="text-end">$<%= Number(it.price * it.quantity).toFixed(2) %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <section class="totals-box">
    <div class="row-line"><span>Subtotal</span><span>$<%= subtotal.toFixed(2) %></span></div>
    <div class="row-line"><span>GST (8%)</span><span>$<%= tax.toFixed(2) %></span></div>
    <div class="row-line total"><span>Total</span><span>$<%= total.toFixed(2) %></span></div>
  </section>

  <footer class="invoice-footer">
    <a class="back-link" href="/orders">&larr; Back to Orders</a>
    <div class="muted">Thank you for shopping with UnFairPrice.</div>
  </footer>
</div>

<script>
  try {
    const params = new URLSearchParams(window.location.search);
    if (params.get('auto') === '1') {
      setTimeout(() => window.print(), 100);
    }
  } catch {}
</script>

<%- include('partials/footer') %>
